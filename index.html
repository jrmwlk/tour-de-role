<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tours de r√¥le ‚Äì Interface</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#0f1115; color:#e9eef7; }
    .wrap { max-width:1000px; margin:0 auto; padding:16px; }
    h1 { font-size:22px; margin:12px 0; }
    .member { display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #262b36; padding:8px 0; }
    .name { flex:1; }
    button { margin:0 2px; padding:6px 10px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
    .btn-semaine { background:#4CAF50; color:white; }
    .btn-dimanche { background:#FF7043; color:white; }
    .card { background:#161a21; border:1px solid #262b36; border-radius:10px; padding:12px; margin-top:12px; }
    .pill { padding:4px 8px; border-radius:999px; background:#1e2430; color:#98a2b3; font-size:12px; }
    .foot { font-size:12px; opacity:0.7; margin-top:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üß≠ Tours de r√¥le ‚Äì √âquipe 18</h1>
    <div id="members" class="card">
      Chargement de l‚Äô√©quipe depuis Google Sheets‚Ä¶
    </div>
    <div id="retourAbs" class="card">
      <div class="pill">√âquipe ‚Äì RETOUR ABS</div>
      <div id="absButtons"></div>
    </div>
    <div id="history" class="card">
      <div class="pill">Historique (local)</div>
      <div id="historyList"></div>
    </div>
    <div class="foot">Les fonctions affich√©es d√©pendent des croix dans la sheet (CM, STR, CPO, SPE, HC). Boutons OT = dimanche/jour f√©ri√©.</div>
  </div>
<script>
const SHEET_ID = "1tQDNxbChlSO0eSH9vdom5Vv8BtDl1Djv3vXuwqKiY_A";
const SHEET_NAME = "EQUIPE";
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

let TEAM = [];

// Charger √©quipe depuis Sheet
async function loadTeam(){
  try{
    const res = await fetch(SHEET_URL);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0,-2));
    const rows = json.table.rows;
    TEAM = rows.map(r => {
      return {
        nom: r.c[0]?.v || "",
        CM: !!r.c[1]?.v,
        STR: !!r.c[2]?.v,
        CPO: !!r.c[3]?.v,
        SPE: !!r.c[4]?.v,
        HC:  !!r.c[5]?.v
      };
    }).filter(m => m.nom);
    renderMembers();
    renderRetourABS();
  }catch(e){
    console.error(e);
    document.getElementById("members").innerHTML = "Erreur chargement √©quipe.";
  }
}

function renderMembers(){
  const box = document.getElementById("members");
  box.innerHTML = "";
  TEAM.forEach(m=>{
    const div = document.createElement("div");
    div.className = "member";
    let btns = "";
    if(m.CM)  btns += `<button class='btn-semaine'>CM</button><button class='btn-dimanche'>CM OT</button>`;
    if(m.STR) btns += `<button class='btn-semaine'>STR</button><button class='btn-dimanche'>STR OT</button>`;
    if(m.CPO) btns += `<button class='btn-semaine'>CPO</button><button class='btn-dimanche'>CPO OT</button>`;
    if(m.SPE) btns += `<button class='btn-semaine'>SPE</button><button class='btn-dimanche'>SPE OT</button>`;
    if(m.HC)  btns += `<button class='btn-semaine'>HC</button><button class='btn-dimanche'>HC OT</button>`;
    div.innerHTML = `<div class='name'>${m.nom}</div><div>${btns}</div>`;
    box.appendChild(div);
  });
}

function renderRetourABS(){
  const box = document.getElementById("absButtons");
  box.innerHTML = "";
  TEAM.forEach(m=>{
    const btn = document.createElement("button");
    btn.textContent = "RETOUR ABS ‚Äì " + m.nom;
    btn.className = "btn-semaine";
    box.appendChild(btn);
  });
}

function renderHistory(){
  document.getElementById("historyList").innerHTML = "<i>(non impl√©ment√© dans cette version d√©mo)</i>";
}

loadTeam();
renderHistory();
</script>
</body>
</html>
