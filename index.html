<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tour de rôle - Debug</title>
  <style>
    body { background:#111; color:#eee; font-family:sans-serif; padding:20px; }
    input, button { padding:6px; margin:4px; }
    #log { white-space:pre; background:#222; padding:10px; border-radius:6px; margin-top:10px; }
  </style>
</head>
<body>
  <h1>Debug — Tour de rôle</h1>

  <label>URL WebApp : <input id="url" style="width:70%"></label>
  <button onclick="saveUrl()">Sauver</button>
  <br>
  <button onclick="testApi('ping')">Tester Ping</button>
  <button onclick="testApi('equipe')">Tester Équipe</button>
  <button onclick="testApi('tours')">Tester Tours</button>

  <h2>Résultat</h2>
  <div id="log"></div>

  <script>
    const urlInput = document.getElementById('url');
    const logDiv = document.getElementById('log');

    function saveUrl() {
      localStorage.setItem('webapp_url', urlInput.value.trim());
      log("✅ URL sauvegardée");
    }

    function getUrl() {
      return localStorage.getItem('webapp_url') || '';
    }

    function log(txt) {
      logDiv.textContent = txt;
    }

    async function testApi(action) {
      const base = getUrl();
      if (!base) { log("❌ Pas d’URL configurée"); return; }

      const cb = "cb" + Date.now();
      window[cb] = data => { log("Réponse :\n" + JSON.stringify(data,null,2)); };

      const s = document.createElement('script');
      s.src = `${base}?action=${action}&callback=${cb}`;
      s.onerror = () => log("❌ Erreur de chargement (peut-être mauvaise URL ou accès non public)");
      document.body.appendChild(s);
    }

    // init
    urlInput.value = getUrl();
  </script>
</body>
</html>
